<!-- templates/menu/reportes.html -->
<div class="card">
  <h3> Reportes Consolidados</h3>

  <!-- === Filtros superiores === -->
  <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:8px;">
    <div style="flex:1; min-width:240px;">
      <label><strong>Periodo</strong></label>
      <select id="reporte-periodo" style="width:100%; padding:6px; border-radius:6px; border:1px solid #ccc;">
        <option value="ultimo">ltimo</option>
        <option value="semestral">Semestral</option>
        <option value="anual">Anual</option>
      </select>
    </div>

    <div style="flex:1; min-width:240px;">
      <label><strong>Tipo</strong></label>
      <select id="reporte-tipo" style="width:100%; padding:6px; border-radius:6px; border:1px solid #ccc;">
        <option value="promedios">Promedios por curso</option>
        <option value="participacion">Participaci贸n</option>
      </select>
    </div>
  </div>

  <!-- === Gr谩fica === -->
  <div style="margin-top:16px;">
    <canvas id="chartReportes" style="width:100%; max-height:340px;"></canvas>
  </div>

  <!-- === Bot贸n de descarga === -->
  <form method="POST" action="{% url 'generar_reporte' %}">
    {% csrf_token %}

    <input type="hidden" name="periodo" id="inputPeriodo">
    <input type="hidden" name="tipo" id="inputTipo">

    <button type="submit"
            style="background:#7b0018; color:white; border:none; padding:8px 14px; border-radius:6px; cursor:pointer;">
        Descargar PDF
    </button>
</form>


  <!-- === Listado de reportes === -->
  <div style="margin-top:20px;">
    <h4> Historial de Reportes</h4>
    <table class="table" style="width:100%; border-collapse:collapse; margin-top:8px;">
      <thead>
        <tr style="background:#7b0018; color:white;">
          <th style="padding:8px;">Reporte</th>
          <th style="padding:8px;">Periodo</th>
          <th style="padding:8px;">Acci贸n</th>
        </tr>
      </thead>
      <tbody>
        {% for r in reportes %}
          <tr style="background:#f9f9f9; border-bottom:1px solid #ddd;">
            <td style="padding:8px;">{{ r.titulo }}</td>
            <td style="padding:8px;">{{ r.periodo }}</td>
            <td style="padding:8px;">
              <button onclick="window.location.href='{{ r.url }}'" 
                      style="background:#9a0021; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">
                Ver
              </button>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="3" style="text-align:center; padding:10px;">No hay reportes generados.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- === Bot贸n de cierre de sesi贸n === -->
  <div style="margin-top:24px; text-align:right;">
    <button onclick="cerrarSesion()" 
            style="background:#900; color:white; padding:6px 12px; border:none; border-radius:6px; cursor:pointer;">
      Cerrar sesi贸n
    </button>
  </div>
</div>

<!-- === Script de Chart.js === -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const ctx = document.getElementById('chartReportes').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ chart_report.labels|default:"['Curso A','Curso B','Curso C']" }},
      datasets: [{
        label: 'Puntaje promedio',
        data: {{ chart_report.data|default:"[85, 78, 92]" }},
        backgroundColor: ['rgba(123, 0, 24, 0.6)', 'rgba(154, 0, 33, 0.6)', 'rgba(100, 0, 20, 0.6)'],
        borderColor: '#7b0018',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'top' },
        title: {
          display: true,
          text: 'Reporte de Desempe帽o Promedio',
          font: { size: 16 }
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100, title: { display: true, text: 'Puntaje (%)' } },
        x: { title: { display: true, text: 'Cursos' } }
      }
    }
  });
});

// Simulaci贸n de descarga PDF
function generarReportePDF() {
  alert(" Generando reporte PDF...");
}

// Simulaci贸n de cierre de sesi贸n
function cerrarSesion() {
  alert("Sesi贸n cerrada correctamente.");
  window.location.href = "{% url 'home' %}";
}



document.querySelector("form").addEventListener("submit", () => {
    document.getElementById("inputPeriodo").value =
        document.getElementById("reporte-periodo").value;

    document.getElementById("inputTipo").value =
        document.getElementById("reporte-tipo").value;
});


</script>
